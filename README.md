# TEST

Для работы неоходимо установить NodeJS, Redis и Geth. 
Установка Geth:
1. Добавить репозиторий - 
```
sudo add-apt-repository -y ppa:ethereum/ethereum
```
2. Поставить стабильную версию - 
```
sudo apt-get update
sudo apt-get install ethereum
```
3. Запустить в лайт режиме - 
```
geth --syncmode=light --ws --ws.port=8546  --http --http.port=8545 --http.api="eth,net,web3"
```
вебсокет для подписки на появление нового блока и http для запросов, хотя можно все и по вебсокету делать.
Geth когда запущен в light моде -  часто теряет пиры, пишет в консоль peercount=0 и перестает отдавать новые блоки, поэтому в продакшн версии необходимо либо использовать full ноду, либо использовать API сторонних провайдеров.
Я использовал API infura.io, надо сделать там аккаунт и создать токен. до 100тыс запросов в день там бесплатно. Еще geth можно поставить в контейнере Docker- ом.. Как впрочем и Redis.

4. Redis установил из исходников

1. Загрузить исходники
```
wget https://download.redis.io/redis-stable.tar.gz
```

2. Распаковать и скомпилировать
```
tar -xzvf redis-stable.tar.gz
cd redis-stable
make
```

3. Если не собираетесь удалять после опытов, то 
```
make install
```

поставит все в /usr/local/bin, 
запустить - ```redis-server```

консоль в редисе - ```redis-cli```
консоль в geth - ```geth attach```

4. В папке  ./src файл search.js запускается с параметрами - 
```
node ./src/search.js <addresstosearch> <blocknumbertosearchat>
```

если нужного блока нет в кэше  - после этого запроса он там останется и повторный запрос выдаст ответ намного быстрее

файл ./src/forward.js - утилита для считывания всех новых блоков (адресов транзакций из них) в кэш - при запуске подписывается на вебсокет "новыйблок" , считывает транзакции, собирает адреса и пишет в кэш.

файл ./src/backward.js - TODO - считывает блоки в прошлое и записывает содержимое в кэш

для работы, естественно, нужен nodejs...
перед запуском в папке с package.json запустить 
```npm i```
